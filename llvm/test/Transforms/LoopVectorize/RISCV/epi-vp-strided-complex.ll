; NOTE: Assertions have been autogenerated by utils/update_test_checks.py
; RUN: opt -mtriple riscv64 -mattr +m,+a,+f,+d,+epi,+experimental-v \
; RUN:    -scalable-vectorization=only -prefer-predicate-over-epilogue=predicate-dont-vectorize \
; RUN:    -S -loop-vectorize -riscv-v-vector-bits-min=64 -instcombine -simplifycfg < %s -o - \
; RUN:    | FileCheck --check-prefix=GATHER %s
; RUN: opt -mtriple riscv64 -mattr +m,+a,+f,+d,+epi,+experimental-v \
; RUN:    -scalable-vectorization=only -prefer-predicate-over-epilogue=predicate-dont-vectorize \
; RUN:    -vectorizer-use-vp-strided-load-store \
; RUN:    -S -loop-vectorize -riscv-v-vector-bits-min=64 -instcombine -simplifycfg < %s -o - \
; RUN:    | FileCheck --check-prefix=STRIDED %s

; ModuleID = 'nostride.c'
source_filename = "nostride.c"
target datalayout = "e-m:e-p:64:64-i64:64-i128:128-n64-S128-v128:128:128-v256:128:128-v512:128:128-v1024:128:128"
target triple = "riscv64-unknown-linux-gnu"

; #include <complex.h>
;
; void foo(int n, int j, float complex temp1, float complex temp2,
;          float complex x[n], float complex y[n], float complex A[n][n]) {
; #pragma clang loop vectorize(assume_safety)
;   for (int i = 0; i <= j - 1; i++) {
;     A[i][j] = A[i][j] + x[i] * temp1 + y[i] * temp2;
;   }
; }

; Function Attrs: nofree norecurse nosync nounwind
define dso_local void @foo(i32 signext %n, i32 signext %j, float %temp1.coerce0, float %temp1.coerce1, float %temp2.coerce0, float %temp2.coerce1, { float, float }* nocapture readonly %x, { float, float }* nocapture readonly %y, { float, float }* nocapture %A) local_unnamed_addr #0 {
; GATHER-LABEL: @foo(
; GATHER-NEXT:  entry:
; GATHER-NEXT:    [[TMP0:%.*]] = zext i32 [[N:%.*]] to i64
; GATHER-NEXT:    [[CMP_NOT_NOT40:%.*]] = icmp sgt i32 [[J:%.*]], 0
; GATHER-NEXT:    br i1 [[CMP_NOT_NOT40]], label [[FOR_BODY_PREHEADER:%.*]], label [[FOR_COND_CLEANUP:%.*]]
; GATHER:       for.body.preheader:
; GATHER-NEXT:    [[IDXPROM1:%.*]] = sext i32 [[J]] to i64
; GATHER-NEXT:    [[WIDE_TRIP_COUNT:%.*]] = zext i32 [[J]] to i64
; GATHER-NEXT:    [[ARRAYIDX:%.*]] = getelementptr inbounds { float, float }, { float, float }* [[A:%.*]], i64 [[IDXPROM1]]
; GATHER-NEXT:    [[TMP1:%.*]] = call <vscale x 2 x i64> @llvm.experimental.stepvector.nxv2i64()
; GATHER-NEXT:    [[BROADCAST_SPLATINSERT1:%.*]] = insertelement <vscale x 2 x i64> poison, i64 [[TMP0]], i64 0
; GATHER-NEXT:    [[BROADCAST_SPLAT2:%.*]] = shufflevector <vscale x 2 x i64> [[BROADCAST_SPLATINSERT1]], <vscale x 2 x i64> poison, <vscale x 2 x i32> zeroinitializer
; GATHER-NEXT:    [[BROADCAST_SPLATINSERT6:%.*]] = insertelement <vscale x 2 x float> poison, float [[TEMP2_COERCE1:%.*]], i64 0
; GATHER-NEXT:    [[BROADCAST_SPLAT7:%.*]] = shufflevector <vscale x 2 x float> [[BROADCAST_SPLATINSERT6]], <vscale x 2 x float> poison, <vscale x 2 x i32> zeroinitializer
; GATHER-NEXT:    [[BROADCAST_SPLATINSERT9:%.*]] = insertelement <vscale x 2 x float> poison, float [[TEMP2_COERCE0:%.*]], i64 0
; GATHER-NEXT:    [[BROADCAST_SPLAT10:%.*]] = shufflevector <vscale x 2 x float> [[BROADCAST_SPLATINSERT9]], <vscale x 2 x float> poison, <vscale x 2 x i32> zeroinitializer
; GATHER-NEXT:    [[BROADCAST_SPLATINSERT15:%.*]] = insertelement <vscale x 2 x float> poison, float [[TEMP1_COERCE1:%.*]], i64 0
; GATHER-NEXT:    [[BROADCAST_SPLAT16:%.*]] = shufflevector <vscale x 2 x float> [[BROADCAST_SPLATINSERT15]], <vscale x 2 x float> poison, <vscale x 2 x i32> zeroinitializer
; GATHER-NEXT:    [[BROADCAST_SPLATINSERT18:%.*]] = insertelement <vscale x 2 x float> poison, float [[TEMP1_COERCE0:%.*]], i64 0
; GATHER-NEXT:    [[BROADCAST_SPLAT19:%.*]] = shufflevector <vscale x 2 x float> [[BROADCAST_SPLATINSERT18]], <vscale x 2 x float> poison, <vscale x 2 x i32> zeroinitializer
; GATHER-NEXT:    br label [[VECTOR_BODY:%.*]]
; GATHER:       vector.body:
; GATHER-NEXT:    [[INDEX:%.*]] = phi i64 [ 0, [[FOR_BODY_PREHEADER]] ], [ [[INDEX_NEXT:%.*]], [[VECTOR_BODY]] ]
; GATHER-NEXT:    [[VEC_IND:%.*]] = phi <vscale x 2 x i64> [ [[TMP1]], [[FOR_BODY_PREHEADER]] ], [ [[VEC_IND_NEXT:%.*]], [[VECTOR_BODY]] ]
; GATHER-NEXT:    [[TMP2:%.*]] = sub i64 [[WIDE_TRIP_COUNT]], [[INDEX]]
; GATHER-NEXT:    [[TMP3:%.*]] = call i64 @llvm.epi.vsetvl(i64 [[TMP2]], i64 2, i64 0)
; GATHER-NEXT:    [[TMP4:%.*]] = trunc i64 [[TMP3]] to i32
; GATHER-NEXT:    [[VP_OP:%.*]] = call <vscale x 2 x i64> @llvm.vp.mul.nxv2i64(<vscale x 2 x i64> [[VEC_IND]], <vscale x 2 x i64> [[BROADCAST_SPLAT2]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[TMP5:%.*]] = getelementptr inbounds { float, float }, { float, float }* [[ARRAYIDX]], <vscale x 2 x i64> [[VP_OP]]
; GATHER-NEXT:    [[TMP6:%.*]] = getelementptr inbounds { float, float }, <vscale x 2 x { float, float }*> [[TMP5]], i64 0, i32 0
; GATHER-NEXT:    [[TMP7:%.*]] = getelementptr inbounds { float, float }, <vscale x 2 x { float, float }*> [[TMP5]], i64 0, i32 1
; GATHER-NEXT:    [[TMP8:%.*]] = getelementptr inbounds { float, float }, { float, float }* [[X:%.*]], <vscale x 2 x i64> [[VEC_IND]], i32 0
; GATHER-NEXT:    [[VP_GATHER:%.*]] = call <vscale x 2 x float> @llvm.vp.gather.nxv2f32.nxv2p0f32(<vscale x 2 x float*> [[TMP8]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[TMP9:%.*]] = getelementptr inbounds { float, float }, { float, float }* [[X]], <vscale x 2 x i64> [[VEC_IND]], i32 1
; GATHER-NEXT:    [[VP_GATHER3:%.*]] = call <vscale x 2 x float> @llvm.vp.gather.nxv2f32.nxv2p0f32(<vscale x 2 x float*> [[TMP9]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[TMP10:%.*]] = getelementptr inbounds { float, float }, { float, float }* [[Y:%.*]], <vscale x 2 x i64> [[VEC_IND]], i32 0
; GATHER-NEXT:    [[VP_GATHER4:%.*]] = call <vscale x 2 x float> @llvm.vp.gather.nxv2f32.nxv2p0f32(<vscale x 2 x float*> [[TMP10]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[TMP11:%.*]] = getelementptr inbounds { float, float }, { float, float }* [[Y]], <vscale x 2 x i64> [[VEC_IND]], i32 1
; GATHER-NEXT:    [[VP_GATHER5:%.*]] = call <vscale x 2 x float> @llvm.vp.gather.nxv2f32.nxv2p0f32(<vscale x 2 x float*> [[TMP11]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP8:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_GATHER4]], <vscale x 2 x float> [[BROADCAST_SPLAT7]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP11:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_GATHER5]], <vscale x 2 x float> [[BROADCAST_SPLAT10]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP12:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_GATHER4]], <vscale x 2 x float> [[BROADCAST_SPLAT10]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP13:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_GATHER5]], <vscale x 2 x float> [[BROADCAST_SPLAT7]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_GATHER14:%.*]] = call <vscale x 2 x float> @llvm.vp.gather.nxv2f32.nxv2p0f32(<vscale x 2 x float*> [[TMP7]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP17:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_GATHER]], <vscale x 2 x float> [[BROADCAST_SPLAT16]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP20:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_GATHER3]], <vscale x 2 x float> [[BROADCAST_SPLAT19]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_GATHER21:%.*]] = call <vscale x 2 x float> @llvm.vp.gather.nxv2f32.nxv2p0f32(<vscale x 2 x float*> [[TMP6]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP22:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_GATHER]], <vscale x 2 x float> [[BROADCAST_SPLAT19]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP23:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_GATHER3]], <vscale x 2 x float> [[BROADCAST_SPLAT16]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP24:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP13]], <vscale x 2 x float> [[VP_OP23]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP25:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP12]], <vscale x 2 x float> [[VP_OP22]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP26:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP25]], <vscale x 2 x float> [[VP_GATHER21]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP27:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fsub.nxv2f32(<vscale x 2 x float> [[VP_OP26]], <vscale x 2 x float> [[VP_OP24]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP28:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP20]], <vscale x 2 x float> [[VP_OP17]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP29:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP28]], <vscale x 2 x float> [[VP_OP8]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP30:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP29]], <vscale x 2 x float> [[VP_GATHER14]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    [[VP_OP31:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP30]], <vscale x 2 x float> [[VP_OP11]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]])
; GATHER-NEXT:    call void @llvm.vp.scatter.nxv2f32.nxv2p0f32(<vscale x 2 x float> [[VP_OP27]], <vscale x 2 x float*> [[TMP6]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]]), !llvm.access.group !4
; GATHER-NEXT:    call void @llvm.vp.scatter.nxv2f32.nxv2p0f32(<vscale x 2 x float> [[VP_OP31]], <vscale x 2 x float*> [[TMP7]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP4]]), !llvm.access.group !4
; GATHER-NEXT:    [[TMP12:%.*]] = and i64 [[TMP3]], 4294967295
; GATHER-NEXT:    [[INDEX_NEXT]] = add i64 [[INDEX]], [[TMP12]]
; GATHER-NEXT:    [[SEXT:%.*]] = shl i64 [[TMP3]], 32
; GATHER-NEXT:    [[TMP13:%.*]] = ashr exact i64 [[SEXT]], 32
; GATHER-NEXT:    [[DOTSPLATINSERT32:%.*]] = insertelement <vscale x 2 x i64> poison, i64 [[TMP13]], i64 0
; GATHER-NEXT:    [[DOTSPLAT33:%.*]] = shufflevector <vscale x 2 x i64> [[DOTSPLATINSERT32]], <vscale x 2 x i64> poison, <vscale x 2 x i32> zeroinitializer
; GATHER-NEXT:    [[VEC_IND_NEXT]] = add <vscale x 2 x i64> [[VEC_IND]], [[DOTSPLAT33]]
; GATHER-NEXT:    [[TMP14:%.*]] = icmp eq i64 [[INDEX_NEXT]], [[WIDE_TRIP_COUNT]]
; GATHER-NEXT:    br i1 [[TMP14]], label [[FOR_COND_CLEANUP]], label [[VECTOR_BODY]], !llvm.loop [[LOOP5:![0-9]+]]
; GATHER:       for.cond.cleanup:
; GATHER-NEXT:    ret void
;
; STRIDED-LABEL: @foo(
; STRIDED-NEXT:  entry:
; STRIDED-NEXT:    [[TMP0:%.*]] = zext i32 [[N:%.*]] to i64
; STRIDED-NEXT:    [[CMP_NOT_NOT40:%.*]] = icmp sgt i32 [[J:%.*]], 0
; STRIDED-NEXT:    br i1 [[CMP_NOT_NOT40]], label [[FOR_BODY_PREHEADER:%.*]], label [[FOR_COND_CLEANUP:%.*]]
; STRIDED:       for.body.preheader:
; STRIDED-NEXT:    [[IDXPROM1:%.*]] = sext i32 [[J]] to i64
; STRIDED-NEXT:    [[WIDE_TRIP_COUNT:%.*]] = zext i32 [[J]] to i64
; STRIDED-NEXT:    [[ARRAYIDX:%.*]] = getelementptr { float, float }, { float, float }* [[A:%.*]], i64 [[IDXPROM1]]
; STRIDED-NEXT:    [[SCEVGEP:%.*]] = getelementptr { float, float }, { float, float }* [[X:%.*]], i64 0, i32 1
; STRIDED-NEXT:    [[SCEVGEP6:%.*]] = getelementptr { float, float }, { float, float }* [[Y:%.*]], i64 0, i32 1
; STRIDED-NEXT:    [[BROADCAST_SPLATINSERT9:%.*]] = insertelement <vscale x 2 x float> poison, float [[TEMP2_COERCE1:%.*]], i64 0
; STRIDED-NEXT:    [[BROADCAST_SPLAT10:%.*]] = shufflevector <vscale x 2 x float> [[BROADCAST_SPLATINSERT9]], <vscale x 2 x float> poison, <vscale x 2 x i32> zeroinitializer
; STRIDED-NEXT:    [[BROADCAST_SPLATINSERT12:%.*]] = insertelement <vscale x 2 x float> poison, float [[TEMP2_COERCE0:%.*]], i64 0
; STRIDED-NEXT:    [[BROADCAST_SPLAT13:%.*]] = shufflevector <vscale x 2 x float> [[BROADCAST_SPLATINSERT12]], <vscale x 2 x float> poison, <vscale x 2 x i32> zeroinitializer
; STRIDED-NEXT:    [[SCEVGEP17:%.*]] = getelementptr { float, float }, { float, float }* [[A]], i64 [[IDXPROM1]], i32 1
; STRIDED-NEXT:    [[TMP1:%.*]] = shl nuw nsw i64 [[TMP0]], 3
; STRIDED-NEXT:    [[BROADCAST_SPLATINSERT20:%.*]] = insertelement <vscale x 2 x float> poison, float [[TEMP1_COERCE1:%.*]], i64 0
; STRIDED-NEXT:    [[BROADCAST_SPLAT21:%.*]] = shufflevector <vscale x 2 x float> [[BROADCAST_SPLATINSERT20]], <vscale x 2 x float> poison, <vscale x 2 x i32> zeroinitializer
; STRIDED-NEXT:    [[BROADCAST_SPLATINSERT23:%.*]] = insertelement <vscale x 2 x float> poison, float [[TEMP1_COERCE0:%.*]], i64 0
; STRIDED-NEXT:    [[BROADCAST_SPLAT24:%.*]] = shufflevector <vscale x 2 x float> [[BROADCAST_SPLATINSERT23]], <vscale x 2 x float> poison, <vscale x 2 x i32> zeroinitializer
; STRIDED-NEXT:    [[TMP2:%.*]] = shl nuw nsw i64 [[TMP0]], 3
; STRIDED-NEXT:    [[TMP3:%.*]] = shl nuw nsw i64 [[TMP0]], 3
; STRIDED-NEXT:    [[SCEVGEP37:%.*]] = getelementptr { float, float }, { float, float }* [[A]], i64 [[IDXPROM1]], i32 1
; STRIDED-NEXT:    [[TMP4:%.*]] = shl nuw nsw i64 [[TMP0]], 3
; STRIDED-NEXT:    br label [[VECTOR_BODY:%.*]]
; STRIDED:       vector.body:
; STRIDED-NEXT:    [[INDEX:%.*]] = phi i64 [ 0, [[FOR_BODY_PREHEADER]] ], [ [[INDEX_NEXT:%.*]], [[VECTOR_BODY]] ]
; STRIDED-NEXT:    [[TMP5:%.*]] = sub i64 [[WIDE_TRIP_COUNT]], [[INDEX]]
; STRIDED-NEXT:    [[TMP6:%.*]] = call i64 @llvm.epi.vsetvl(i64 [[TMP5]], i64 2, i64 0)
; STRIDED-NEXT:    [[TMP7:%.*]] = trunc i64 [[TMP6]] to i32
; STRIDED-NEXT:    [[TMP8:%.*]] = getelementptr { float, float }, { float, float }* [[X]], i64 [[INDEX]], i32 0
; STRIDED-NEXT:    [[VP_STRIDED_LOAD:%.*]] = call <vscale x 2 x float> @llvm.experimental.vp.strided.load.nxv2f32.p0f32.i64(float* [[TMP8]], i64 8, <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[TMP9:%.*]] = shl i64 [[INDEX]], 1
; STRIDED-NEXT:    [[TMP10:%.*]] = getelementptr float, float* [[SCEVGEP]], i64 [[TMP9]]
; STRIDED-NEXT:    [[VP_STRIDED_LOAD4:%.*]] = call <vscale x 2 x float> @llvm.experimental.vp.strided.load.nxv2f32.p0f32.i64(float* [[TMP10]], i64 8, <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[TMP11:%.*]] = getelementptr { float, float }, { float, float }* [[Y]], i64 [[INDEX]], i32 0
; STRIDED-NEXT:    [[VP_STRIDED_LOAD5:%.*]] = call <vscale x 2 x float> @llvm.experimental.vp.strided.load.nxv2f32.p0f32.i64(float* [[TMP11]], i64 8, <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[TMP12:%.*]] = shl i64 [[INDEX]], 1
; STRIDED-NEXT:    [[TMP13:%.*]] = getelementptr float, float* [[SCEVGEP6]], i64 [[TMP12]]
; STRIDED-NEXT:    [[VP_STRIDED_LOAD8:%.*]] = call <vscale x 2 x float> @llvm.experimental.vp.strided.load.nxv2f32.p0f32.i64(float* [[TMP13]], i64 8, <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP11:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_STRIDED_LOAD5]], <vscale x 2 x float> [[BROADCAST_SPLAT10]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP14:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_STRIDED_LOAD8]], <vscale x 2 x float> [[BROADCAST_SPLAT13]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP15:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_STRIDED_LOAD5]], <vscale x 2 x float> [[BROADCAST_SPLAT13]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP16:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_STRIDED_LOAD8]], <vscale x 2 x float> [[BROADCAST_SPLAT10]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[TMP14:%.*]] = mul i64 [[INDEX]], [[TMP1]]
; STRIDED-NEXT:    [[TMP15:%.*]] = bitcast float* [[SCEVGEP17]] to i8*
; STRIDED-NEXT:    [[TMP16:%.*]] = getelementptr i8, i8* [[TMP15]], i64 [[TMP14]]
; STRIDED-NEXT:    [[TMP17:%.*]] = bitcast i8* [[TMP16]] to float*
; STRIDED-NEXT:    [[VP_STRIDED_LOAD19:%.*]] = call <vscale x 2 x float> @llvm.experimental.vp.strided.load.nxv2f32.p0f32.i64(float* [[TMP17]], i64 [[TMP1]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP22:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_STRIDED_LOAD]], <vscale x 2 x float> [[BROADCAST_SPLAT21]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP25:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_STRIDED_LOAD4]], <vscale x 2 x float> [[BROADCAST_SPLAT24]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[TMP18:%.*]] = mul i64 [[INDEX]], [[TMP2]]
; STRIDED-NEXT:    [[TMP19:%.*]] = bitcast { float, float }* [[ARRAYIDX]] to i8*
; STRIDED-NEXT:    [[TMP20:%.*]] = getelementptr i8, i8* [[TMP19]], i64 [[TMP18]]
; STRIDED-NEXT:    [[TMP21:%.*]] = bitcast i8* [[TMP20]] to float*
; STRIDED-NEXT:    [[VP_STRIDED_LOAD26:%.*]] = call <vscale x 2 x float> @llvm.experimental.vp.strided.load.nxv2f32.p0f32.i64(float* [[TMP21]], i64 [[TMP2]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP27:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_STRIDED_LOAD]], <vscale x 2 x float> [[BROADCAST_SPLAT24]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP28:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fmul.nxv2f32(<vscale x 2 x float> [[VP_STRIDED_LOAD4]], <vscale x 2 x float> [[BROADCAST_SPLAT21]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP29:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP16]], <vscale x 2 x float> [[VP_OP28]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP30:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP15]], <vscale x 2 x float> [[VP_OP27]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP31:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP30]], <vscale x 2 x float> [[VP_STRIDED_LOAD26]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP32:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fsub.nxv2f32(<vscale x 2 x float> [[VP_OP31]], <vscale x 2 x float> [[VP_OP29]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP33:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP25]], <vscale x 2 x float> [[VP_OP22]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP34:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP33]], <vscale x 2 x float> [[VP_OP11]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP35:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP34]], <vscale x 2 x float> [[VP_STRIDED_LOAD19]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[VP_OP36:%.*]] = call fast <vscale x 2 x float> @llvm.vp.fadd.nxv2f32(<vscale x 2 x float> [[VP_OP35]], <vscale x 2 x float> [[VP_OP14]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]])
; STRIDED-NEXT:    [[TMP22:%.*]] = mul i64 [[INDEX]], [[TMP3]]
; STRIDED-NEXT:    [[TMP23:%.*]] = bitcast { float, float }* [[ARRAYIDX]] to i8*
; STRIDED-NEXT:    [[TMP24:%.*]] = getelementptr i8, i8* [[TMP23]], i64 [[TMP22]]
; STRIDED-NEXT:    [[TMP25:%.*]] = bitcast i8* [[TMP24]] to float*
; STRIDED-NEXT:    call void @llvm.experimental.vp.strided.store.nxv2f32.p0f32.i64(<vscale x 2 x float> [[VP_OP32]], float* [[TMP25]], i64 [[TMP3]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]]), !llvm.access.group !4
; STRIDED-NEXT:    [[TMP26:%.*]] = mul i64 [[INDEX]], [[TMP4]]
; STRIDED-NEXT:    [[TMP27:%.*]] = bitcast float* [[SCEVGEP37]] to i8*
; STRIDED-NEXT:    [[TMP28:%.*]] = getelementptr i8, i8* [[TMP27]], i64 [[TMP26]]
; STRIDED-NEXT:    [[TMP29:%.*]] = bitcast i8* [[TMP28]] to float*
; STRIDED-NEXT:    call void @llvm.experimental.vp.strided.store.nxv2f32.p0f32.i64(<vscale x 2 x float> [[VP_OP36]], float* [[TMP29]], i64 [[TMP4]], <vscale x 2 x i1> shufflevector (<vscale x 2 x i1> insertelement (<vscale x 2 x i1> poison, i1 true, i32 0), <vscale x 2 x i1> poison, <vscale x 2 x i32> zeroinitializer), i32 [[TMP7]]), !llvm.access.group !4
; STRIDED-NEXT:    [[TMP30:%.*]] = and i64 [[TMP6]], 4294967295
; STRIDED-NEXT:    [[INDEX_NEXT]] = add i64 [[INDEX]], [[TMP30]]
; STRIDED-NEXT:    [[TMP31:%.*]] = icmp eq i64 [[INDEX_NEXT]], [[WIDE_TRIP_COUNT]]
; STRIDED-NEXT:    br i1 [[TMP31]], label [[FOR_COND_CLEANUP]], label [[VECTOR_BODY]], !llvm.loop [[LOOP5:![0-9]+]]
; STRIDED:       for.cond.cleanup:
; STRIDED-NEXT:    ret void
;
entry:
  %0 = zext i32 %n to i64
  %cmp.not.not40 = icmp sgt i32 %j, 0
  br i1 %cmp.not.not40, label %for.body.preheader, label %for.cond.cleanup

for.body.preheader:                               ; preds = %entry
  %idxprom1 = sext i32 %j to i64
  %wide.trip.count = zext i32 %j to i64
  %arrayidx = getelementptr inbounds { float, float }, { float, float }* %A, i64 %idxprom1
  br label %for.body

for.cond.cleanup.loopexit:                        ; preds = %for.body
  br label %for.cond.cleanup

for.cond.cleanup:                                 ; preds = %for.cond.cleanup.loopexit, %entry
  ret void

for.body:                                         ; preds = %for.body.preheader, %for.body
  %indvars.iv = phi i64 [ 0, %for.body.preheader ], [ %indvars.iv.next, %for.body ]
  %1 = mul nuw nsw i64 %indvars.iv, %0
  %arrayidx2 = getelementptr inbounds { float, float }, { float, float }* %arrayidx, i64 %1
  %arrayidx2.realp = getelementptr inbounds { float, float }, { float, float }* %arrayidx2, i64 0, i32 0
  %arrayidx2.imagp = getelementptr inbounds { float, float }, { float, float }* %arrayidx2, i64 0, i32 1
  %arrayidx4.realp = getelementptr inbounds { float, float }, { float, float }* %x, i64 %indvars.iv, i32 0
  %arrayidx4.real = load float, float* %arrayidx4.realp, align 4, !llvm.access.group !4
  %arrayidx4.imagp = getelementptr inbounds { float, float }, { float, float }* %x, i64 %indvars.iv, i32 1
  %arrayidx4.imag = load float, float* %arrayidx4.imagp, align 4, !llvm.access.group !4
  %arrayidx7.realp = getelementptr inbounds { float, float }, { float, float }* %y, i64 %indvars.iv, i32 0
  %arrayidx7.real = load float, float* %arrayidx7.realp, align 4, !llvm.access.group !4
  %arrayidx7.imagp = getelementptr inbounds { float, float }, { float, float }* %y, i64 %indvars.iv, i32 1
  %arrayidx7.imag = load float, float* %arrayidx7.imagp, align 4, !llvm.access.group !4
  %mul_ad10 = fmul fast float %arrayidx7.real, %temp2.coerce1
  %mul_bc11 = fmul fast float %arrayidx7.imag, %temp2.coerce0
  %mul_ac8 = fmul fast float %arrayidx7.real, %temp2.coerce0
  %mul_bd9.neg = fmul fast float %arrayidx7.imag, %temp2.coerce1
  %arrayidx2.imag = load float, float* %arrayidx2.imagp, align 4, !llvm.access.group !4
  %mul_ad = fmul fast float %arrayidx4.real, %temp1.coerce1
  %mul_bc = fmul fast float %arrayidx4.imag, %temp1.coerce0
  %arrayidx2.real = load float, float* %arrayidx2.realp, align 4, !llvm.access.group !4
  %mul_ac = fmul fast float %arrayidx4.real, %temp1.coerce0
  %mul_bd.neg = fmul fast float %arrayidx4.imag, %temp1.coerce1
  %reass.add = fadd fast float %mul_bd9.neg, %mul_bd.neg
  %add.r = fadd fast float %mul_ac8, %mul_ac
  %mul_r12 = fadd fast float %add.r, %arrayidx2.real
  %add.r22 = fsub fast float %mul_r12, %reass.add
  %mul_i13 = fadd fast float %mul_bc, %mul_ad
  %mul_i = fadd fast float %mul_i13, %mul_ad10
  %add.i = fadd fast float %mul_i, %arrayidx2.imag
  %add.i23 = fadd fast float %add.i, %mul_bc11
  store float %add.r22, float* %arrayidx2.realp, align 4, !llvm.access.group !4
  store float %add.i23, float* %arrayidx2.imagp, align 4, !llvm.access.group !4
  %indvars.iv.next = add nuw nsw i64 %indvars.iv, 1
  %exitcond.not = icmp eq i64 %indvars.iv.next, %wide.trip.count
  br i1 %exitcond.not, label %for.cond.cleanup.loopexit, label %for.body, !llvm.loop !5
}

attributes #0 = { nofree norecurse nosync nounwind "frame-pointer"="none" "min-legal-vector-width"="0" "no-infs-fp-math"="true" "no-nans-fp-math"="true" "no-signed-zeros-fp-math"="true" "no-trapping-math"="true" "stack-protector-buffer-size"="8" "target-features"="+64bit,+a,+c,+d,+epi,+experimental-v,+experimental-zvlsseg,+f,+m,-relax,-save-restore" "unsafe-fp-math"="true" }

!llvm.module.flags = !{!0, !1, !2}
!llvm.ident = !{!3}

!0 = !{i32 1, !"wchar_size", i32 4}
!1 = !{i32 1, !"target-abi", !"lp64d"}
!2 = !{i32 1, !"SmallDataLimit", i32 8}
!3 = !{!"clang version 14.0.0"}
!4 = distinct !{}
!5 = distinct !{!5, !6, !7, !8}
!6 = !{!"llvm.loop.mustprogress"}
!7 = !{!"llvm.loop.parallel_accesses", !4}
!8 = !{!"llvm.loop.vectorize.enable", i1 true}

